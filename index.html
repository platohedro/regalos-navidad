<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador de Regalos Solidarios</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        .counter-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .counter {
            border: 2px solid #333;
            padding: 10px;
            width: 200px;
        }
        .form-container {
            background-color: #f4f4f4;
            padding: 20px;
            border-radius: 10px;
        }
        input, select, button {
            margin: 10px 0;
            padding: 10px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Campaña de Regalos Solidarios</h1>
    
    <div class="counter-container">
        <div class="counter">
            <h2>Regalos para Niños</h2>
            <p id="boys-count">0</p>
            <p>Meta: 40</p>
        </div>
        <div class="counter">
            <h2>Regalos para Niñas</h2>
            <p id="girls-count">0</p>
            <p>Meta: 40</p>
        </div>
    </div>

    <div class="form-container">
        <h3>Registrar Nuevo Regalo</h3>
        <select id="gift-type">
            <option value="boys">Para Niños</option>
            <option value="girls">Para Niñas</option>
        </select>
        <input type="text" id="gift-description" placeholder="Describe el regalo">
        <button onclick="registerGift()">Registrar Regalo</button>
    </div>

    <h3>Últimos Regalos Registrados</h3>
    <ul id="gifts-list"></ul>

    <script>
        // Crear un objeto de almacenamiento en memoria
        const StorageManager = {
            data: {
                boysCount: 0,
                girlsCount: 0,
                giftsList: []
            },
            
            // Método para obtener un valor
            getItem: function(key) {
                switch(key) {
                    case 'boysCount':
                        return this.data.boysCount.toString();
                    case 'girlsCount':
                        return this.data.girlsCount.toString();
                    case 'giftsList':
                        return JSON.stringify(this.data.giftsList);
                    default:
                        return null;
                }
            },
            
            // Método para establecer un valor
            setItem: function(key, value) {
                switch(key) {
                    case 'boysCount':
                        this.data.boysCount = parseInt(value);
                        break;
                    case 'girlsCount':
                        this.data.girlsCount = parseInt(value);
                        break;
                    case 'giftsList':
                        this.data.giftsList = JSON.parse(value);
                        break;
                }
            }
        };

        // Función para determinar qué almacenamiento usar
        function getStorageMethod() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return localStorage;
            } catch(e) {
                console.warn('localStorage not available, using in-memory storage');
                return StorageManager;
            }
        }

        // Seleccionar el método de almacenamiento
        const storage = getStorageMethod();

        // Inicializar datos si no existen
        if (!storage.getItem('boysCount')) {
            storage.setItem('boysCount', '0');
        }
        if (!storage.getItem('girlsCount')) {
            storage.setItem('girlsCount', '0');
        }
        if (!storage.getItem('giftsList')) {
            storage.setItem('giftsList', JSON.stringify([]));
        }

        // Actualizar contadores al cargar la página
        function updateCounters() {
            const boysCount = parseInt(storage.getItem('boysCount'));
            const girlsCount = parseInt(storage.getItem('girlsCount'));
            
            document.getElementById('boys-count').textContent = boysCount;
            document.getElementById('girls-count').textContent = girlsCount;

            // Actualizar lista de regalos
            const giftsList = JSON.parse(storage.getItem('giftsList'));
            const giftsListElement = document.getElementById('gifts-list');
            giftsListElement.innerHTML = ''; // Limpiar lista anterior
            
            giftsList.slice(-5).reverse().forEach(gift => {
                const li = document.createElement('li');
                li.textContent = `${gift.type === 'boys' ? 'Niño' : 'Niña'}: ${gift.description}`;
                giftsListElement.appendChild(li);
            });
        }

        // Llamar a updateCounters cuando se carga la página
        updateCounters();

        function registerGift() {
            const giftType = document.getElementById('gift-type').value;
            const giftDescription = document.getElementById('gift-description').value.trim();

            // Validar que se haya ingresado una descripción
            if (!giftDescription) {
                alert('Por favor, describe el regalo');
                return;
            }

            // Obtener contadores actuales
            let boysCount = parseInt(storage.getItem('boysCount'));
            let girlsCount = parseInt(storage.getItem('girlsCount'));

            // Validar límite de regalos
            if (giftType === 'boys' && boysCount >= 40) {
                alert('Ya se han registrado 40 regalos para niños');
                return;
            }
            if (giftType === 'girls' && girlsCount >= 40) {
                alert('Ya se han registrado 40 regalos para niñas');
                return;
            }

            // Incrementar contador
            if (giftType === 'boys') {
                boysCount++;
                storage.setItem('boysCount', boysCount.toString());
            } else {
                girlsCount++;
                storage.setItem('girlsCount', girlsCount.toString());
            }

            // Guardar regalo en la lista
            const giftsList = JSON.parse(storage.getItem('giftsList'));
            giftsList.push({
                type: giftType,
                description: giftDescription
            });
            storage.setItem('giftsList', JSON.stringify(giftsList));

            // Limpiar campo de descripción
            document.getElementById('gift-description').value = '';

            // Actualizar vista
            updateCounters();
        }
    </script>
</body>
</html>